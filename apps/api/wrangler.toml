name = "paillette-api"
main = "src/index.ts"
compatibility_date = "2024-11-01"
compatibility_flags = ["nodejs_compat"]

# Account ID - update with your Cloudflare account ID
# account_id = "your-account-id-here"

[observability]
enabled = true

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "paillette-db"
database_id = "your-d1-database-id"  # Create with: wrangler d1 create paillette-db

# R2 Storage
[[r2_buckets]]
binding = "IMAGES"
bucket_name = "paillette-images"

# Vectorize
[[vectorize]]
binding = "VECTORIZE"
index_name = "artwork-embeddings"

# KV for caching
[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"

# AI binding
[ai]
binding = "AI"

# Queue for async processing
[[queues.producers]]
binding = "EMBEDDING_QUEUE"
queue = "embedding-jobs"

[[queues.consumers]]
queue = "embedding-jobs"
max_batch_size = 10
max_batch_timeout = 30

# Environment variables (use .dev.vars for local development)
[vars]
ENVIRONMENT = "development"
API_VERSION = "v1"

# Staging environment (deploy from 'staging' branch)
[env.staging]
name = "paillette-stg"
vars = { ENVIRONMENT = "staging" }

# Staging resources (separate from production)
[[env.staging.d1_databases]]
binding = "DB"
database_name = "paillette-db-staging"
database_id = "your-staging-d1-id"  # Create with: wrangler d1 create paillette-db-staging

[[env.staging.r2_buckets]]
binding = "IMAGES"
bucket_name = "paillette-images-staging"

[[env.staging.vectorize]]
binding = "VECTORIZE"
index_name = "artwork-embeddings-staging"

[[env.staging.kv_namespaces]]
binding = "CACHE"
id = "your-staging-kv-id"

[[env.staging.queues.producers]]
binding = "EMBEDDING_QUEUE"
queue = "embedding-jobs-staging"

[[env.staging.queues.consumers]]
queue = "embedding-jobs-staging"
max_batch_size = 10
max_batch_timeout = 30

# Production environment (deploy from 'master' branch)
[env.production]
name = "paillette"
vars = { ENVIRONMENT = "production" }

# Production uses the main bindings defined above
